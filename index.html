<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invoice Hijab Dlingo Scarves</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
      body {
        font-family: "Helvetica", sans-serif;
        background-color: #e6ebf5;
      }
      .navy-text {
        color: #0b3d91;
      }
      .navy-bg {
        background-color: #0b3d91;
      }
      .stamp-lunas {
        color: #ff0000;
        font-size: 4rem;
        font-weight: bold;
        opacity: 0.7;
        transform: rotate(-15deg);
        display: inline-block;
      }
      .total-black {
        color: #000;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        word-wrap: break-word;
      }
      th,
      td {
        border: 1px solid #000;
        padding: 0.5rem;
        text-align: left;
      }
      input {
        outline: none;
      }

      /* ✅ Supaya footer selalu ikut di PDF */
      #invoiceFooter {
        page-break-inside: avoid;
        page-break-after: auto;
        position: relative;
        bottom: 0;
        left: 0;
        right: 0;
      }
    </style>
  </head>
  <body class="p-4 sm:p-8">
    <!-- (Tampilan HTML tetap sama persis seperti yang mas kasih) -->
    <div class="max-w-6xl mx-auto mb-6">
      <h2 class="text-2xl sm:text-3xl font-bold mb-4 navy-text">
        Isi Invoice Toko Hijab Dlingoscarves
      </h2>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
        <input
          type="text"
          id="billName"
          placeholder="Nama Penerima"
          class="border px-3 py-2 rounded w-full"
        />
        <input
          type="text"
          id="billAddress"
          placeholder="Alamat Penerima"
          class="border px-3 py-2 rounded w-full"
        />
        <input
          type="text"
          id="invoiceDate"
          placeholder="Tanggal Invoice"
          class="border px-3 py-2 rounded w-full"
        />
        <input
          type="text"
          id="dueDate"
          placeholder="Tanggal Jatuh Tempo"
          class="border px-3 py-2 rounded w-full"
        />
      </div>

      <h3 class="font-semibold mb-2 navy-text">Produk Hijab</h3>
      <div id="itemsContainer" class="mb-4">
        <div class="flex flex-wrap gap-2 mb-2">
          <input
            type="text"
            placeholder="Jenis Hijab"
            class="border px-3 py-2 rounded w-full sm:w-1/4 item-name"
          />
          <input
            type="text"
            placeholder="Warna / Motif"
            class="border px-3 py-2 rounded w-full sm:w-1/4 item-color"
          />
          <input
            type="number"
            placeholder="Jumlah"
            class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-qty"
          />
          <input
            type="number"
            placeholder="Harga (Rp)"
            class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-price"
          />
          <input
            type="number"
            placeholder="Ongkir (Rp)"
            class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-ongkir"
          />
        </div>
      </div>
      <button
        type="button"
        id="addItem"
        class="mb-4 navy-bg text-white px-4 py-2 rounded hover:bg-blue-800"
      >
        Tambah Produk
      </button>
    </div>

    <!-- Tombol Action -->
    <div
      class="text-center mb-6 flex flex-col sm:flex-row justify-center gap-2"
    >
      <button
        type="button"
        id="generateInvoiceTagihan"
        class="navy-bg text-white px-6 py-2 rounded hover:bg-blue-800"
      >
        Generate PDF Tagihan
      </button>
      <button
        type="button"
        id="generateInvoicePelunasan"
        class="navy-bg text-white px-6 py-2 rounded hover:bg-blue-800"
      >
        Generate PDF Pelunasan
      </button>
      <button
        type="button"
        onclick="resetInvoiceNumber()"
        class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-800"
      >
        Reset Nomor Invoice
      </button>
    </div>

    <!-- Preview Invoice -->
    <div
      id="invoicePreview"
      class="max-w-[210mm] mx-auto bg-white p-4 sm:p-8 shadow-2xl rounded-lg relative"
    >
      <div
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b-4 border-black pb-4 mb-6"
      >
        <div class="flex items-center gap-4 mb-4 sm:mb-0">
          <img src="img/dlingo.jpeg" alt="Logo Toko" class="h-12" />
          <h1 class="text-2xl sm:text-3xl font-bold navy-text">INVOICE</h1>
          <p class="text-gray-600 mt-1" id="invoiceNumber">INC-001</p>
        </div>
        <div class="text-left sm:text-right text-sm text-gray-700">
          <p>Toko Hijab Dlingoscarves</p>
          <p>Jakarta</p>
          <p>Instagram: @Dlingoscarves</p>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
        <div>
          <h2 class="font-semibold navy-text">Bill To:</h2>
          <p>Nama Penerima: <span id="previewName">-</span></p>
          <p>Alamat Penerima: <span id="previewAddress">-</span></p>
        </div>
        <div>
          <h2 class="font-semibold navy-text">Invoice Info:</h2>
          <p>Invoice Tanggal: <span id="previewDate">-</span></p>
          <p>Invoice Due: <span id="previewDue">-</span></p>
        </div>
      </div>

      <div class="overflow-x-auto mb-6">
        <table>
          <thead class="bg-blue-100">
            <tr>
              <th>Nama Hijab</th>
              <th>Warna / Motif</th>
              <th>Jumlah</th>
              <th>Harga</th>
              <th>Ongkir</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody id="previewTable"></tbody>
        </table>
      </div>

      <div class="flex flex-col items-end">
        <p class="font-semibold mt-2">Subtotal: <span id="subtotal">0</span></p>
        <p class="font-bold text-xl total-black mt-4">
          Total: <span id="total">0</span>
        </p>
        <div id="stampLunas" class="hidden">
          <span class="stamp-lunas">LUNAS</span>
        </div>
      </div>

      <!-- ✅ Footer ikut di PDF -->
      <div id="invoiceFooter" class="mt-6 text-gray-700 text-sm sm:text-base">
        <p>
          Thank you for your order.<br />
          Pembayaran dapat dilakukan ke:<br />
          Bank BCA 1661739679 | Bank Jakarta 50020082764: a/n Pancaningsih<br />
          Instagram: @Dlingoscarves | telfon: 0857-1825-1218
        </p>
      </div>
    </div>

    <script>
      const addItemBtn = document.getElementById("addItem");
      const itemsContainer = document.getElementById("itemsContainer");
      let invoiceNumber = parseInt(localStorage.getItem("invoiceNumber")) || 1;

      function updateInvoiceNumber() {
        document.getElementById("invoiceNumber").textContent =
          "INC-" + String(invoiceNumber).padStart(3, "0");
      }

      function resetInvoiceNumber() {
        invoiceNumber = 1;
        localStorage.setItem("invoiceNumber", invoiceNumber);
        updateInvoiceNumber();
        alert("Nomor invoice sudah direset ke 1");
      }

      addItemBtn.addEventListener("click", () => {
        const div = document.createElement("div");
        div.className = "flex flex-wrap gap-2 mb-2";
        div.innerHTML = `
          <input type="text" placeholder="Jenis Hijab" class="border px-3 py-2 rounded w-full sm:w-1/4 item-name">
          <input type="text" placeholder="Warna / Motif" class="border px-3 py-2 rounded w-full sm:w-1/4 item-color">
          <input type="number" placeholder="Jumlah" class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-qty">
          <input type="number" placeholder="Harga (Rp)" class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-price">
          <input type="number" placeholder="Ongkir (Rp)" class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-ongkir">
        `;
        itemsContainer.appendChild(div);
      });

      function updatePreview() {
        document.getElementById("previewName").textContent =
          document.getElementById("billName").value || "-";
        document.getElementById("previewAddress").textContent =
          document.getElementById("billAddress").value || "-";
        document.getElementById("previewDate").textContent =
          document.getElementById("invoiceDate").value || "-";
        document.getElementById("previewDue").textContent =
          document.getElementById("dueDate").value || "-";
      }

      ["billName", "billAddress", "invoiceDate", "dueDate"].forEach((id) => {
        document.getElementById(id).addEventListener("input", updatePreview);
      });
      updatePreview();
      updateInvoiceNumber();

      function generatePDF(filename, showLunas) {
        updatePreview();
        updateInvoiceNumber();

        const tbody = document.getElementById("previewTable");
        tbody.innerHTML = "";
        let subtotal = 0;

        const names = document.querySelectorAll(".item-name");
        const colors = document.querySelectorAll(".item-color");
        const qtys = document.querySelectorAll(".item-qty");
        const prices = document.querySelectorAll(".item-price");
        const ongkirs = document.querySelectorAll(".item-ongkir");

        for (let i = 0; i < names.length; i++) {
          const n = names[i].value || "-";
          const c = colors[i].value || "-";
          const q = parseFloat(qtys[i].value) || 0;
          const p = parseFloat(prices[i].value) || 0;
          const o = parseFloat(ongkirs[i].value) || 0;
          const total = q * p + o;
          subtotal += total;

          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${n}</td>
            <td>${c}</td>
            <td class="text-right">${q}</td>
            <td class="text-right">Rp${p.toLocaleString()}</td>
            <td class="text-right">Rp${o.toLocaleString()}</td>
            <td class="text-right">Rp${total.toLocaleString()}</td>
          `;
          tbody.appendChild(tr);
        }

        document.getElementById("subtotal").textContent =
          "Rp" + subtotal.toLocaleString();
        document.getElementById("total").textContent =
          "Rp" + subtotal.toLocaleString();
        document
          .getElementById("stampLunas")
          .classList.toggle("hidden", !showLunas);

        html2pdf()
          .set({
            margin: [10, 10, 20, 10], // ✅ kasih space bawah untuk footer
            filename: filename,
            image: { type: "jpeg", quality: 1 },
            html2canvas: { scale: 3 },
            jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
            pagebreak: { mode: ["css", "legacy"] },
          })
          .from(document.getElementById("invoicePreview"))
          .save();

        invoiceNumber++;
        localStorage.setItem("invoiceNumber", invoiceNumber);
      }

      document
        .getElementById("generateInvoiceTagihan")
        .addEventListener("click", () => generatePDF("Tagihan.pdf", false));
      document
        .getElementById("generateInvoicePelunasan")
        .addEventListener("click", () => generatePDF("Pelunasan.pdf", true));
    </script>
  </body>
</html>
