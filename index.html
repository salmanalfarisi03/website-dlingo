<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Invoice Hijab Dlingo Scarves</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
      body {
        font-family: "Helvetica", sans-serif;
        background-color: #e6ebf5;
      }
      .navy-text {
        color: #0b3d91;
      }
      .navy-bg {
        background-color: #0b3d91;
      }
      .stamp-lunas {
        color: #ff0000;
        font-size: 4rem;
        font-weight: bold;
        opacity: 0.7;
        transform: rotate(-15deg);
        display: inline-block;
      }
      .total-black {
        color: #000000;
      }
      /* Table agar PDF rapi */
      table {
        width: 100%;
        border-collapse: collapse;
        table-layout: fixed;
        word-wrap: break-word;
      }
      th,
      td {
        border: 1px solid #000;
        padding: 0.5rem;
        text-align: left;
      }
      @media print {
        body {
          zoom: 0.8;
        }
      }
    </style>
  </head>
  <body class="p-4 sm:p-8">
    <div class="max-w-6xl mx-auto mb-6">
      <h2 class="text-2xl sm:text-3xl font-bold mb-4 navy-text">
        Isi Invoice Toko Hijab Dlingoscarves
      </h2>

      <!-- Input Info -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
        <input
          type="text"
          id="billName"
          placeholder="Nama Penerima"
          class="border px-3 py-2 rounded w-full"
        />
        <input
          type="text"
          id="billAddress"
          placeholder="Alamat Penerima"
          class="border px-3 py-2 rounded w-full"
        />
        <input
          type="text"
          id="invoiceDate"
          placeholder="Tanggal Invoice"
          class="border px-3 py-2 rounded w-full"
        />
        <input
          type="text"
          id="dueDate"
          placeholder="Tanggal Jatuh Tempo"
          class="border px-3 py-2 rounded w-full"
        />
      </div>

      <!-- Produk -->
      <h3 class="font-semibold mb-2 navy-text">Produk Hijab</h3>
      <div id="itemsContainer" class="mb-4">
        <div class="flex flex-wrap gap-2 mb-2">
          <input
            type="text"
            placeholder="Jenis Hijab"
            class="border px-3 py-2 rounded w-full sm:w-1/4 item-name"
          />
          <input
            type="text"
            placeholder="Warna / Motif"
            class="border px-3 py-2 rounded w-full sm:w-1/4 item-color"
          />
          <input
            type="number"
            placeholder="Jumlah"
            class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-qty"
          />
          <input
            type="number"
            placeholder="Harga (Rp)"
            class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-price"
          />
          <input
            type="number"
            placeholder="Ongkir (Rp)"
            class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-ongkir"
          />
        </div>
      </div>
      <button
        id="addItem"
        class="mb-4 navy-bg text-white px-4 py-2 rounded hover:bg-blue-800"
      >
        Tambah Produk
      </button>
    </div>

    <!-- Buttons -->
    <div
      class="text-center mb-6 flex flex-col sm:flex-row justify-center gap-2"
    >
      <button
        id="generateInvoiceTagihan"
        class="navy-bg text-white px-6 py-2 rounded hover:bg-blue-800"
      >
        Generate PDF Tagihan
      </button>
      <button
        id="generateInvoicePelunasan"
        class="navy-bg text-white px-6 py-2 rounded hover:bg-blue-800"
      >
        Generate PDF Pelunasan
      </button>
    </div>

    <!-- Invoice Preview -->
    <div
      id="invoicePreview"
      class="max-w-[210mm] mx-auto bg-white p-4 sm:p-8 shadow-2xl rounded-lg relative"
    >
      <!-- Watermark -->
      <div
        class="absolute inset-0 flex justify-center items-center pointer-events-none opacity-5"
      >
        <img src="img/dlingo.jpeg" alt="Watermark" class="w-64 sm:w-96" />
      </div>

      <!-- Header -->
      <div
        class="flex flex-col sm:flex-row justify-between items-start sm:items-center border-b-4 border-black pb-4 mb-6 relative z-10"
      >
        <div class="flex items-center gap-4 mb-4 sm:mb-0">
          <img src="img/dlingo.jpeg" alt="Logo Toko" class="h-16 sm:h-20" />
          <div>
            <h1 class="text-2xl sm:text-3xl font-bold navy-text">INVOICE</h1>
            <p class="text-gray-600 mt-1" id="invoiceNumber">INC-001</p>
          </div>
        </div>
        <div class="text-left sm:text-right text-sm text-gray-700">
          <p>Toko Hijab Dlingoscarves</p>
          <p>Jakarta</p>
          <p>Instagram: @Dlingoscarves</p>
        </div>
      </div>

      <!-- Billing Info -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6 relative z-10">
        <div>
          <h2 class="font-semibold navy-text">Bill To:</h2>
          <p id="previewName">Nama Penerima:</p>
          <p id="previewAddress">Alamat Penerima:</p>
        </div>
        <div>
          <h2 class="font-semibold navy-text">Invoice Info:</h2>
          <p id="previewDate">Invoice Tanggal:</p>
          <p id="previewDue">Invoice Due Date:</p>
        </div>
      </div>

      <!-- Table -->
      <div class="overflow-x-auto mb-6">
        <table class="w-full text-sm">
          <thead class="bg-blue-100">
            <tr>
              <th>Nama Hijab</th>
              <th>Warna / Motif</th>
              <th>Jumlah</th>
              <th>Harga</th>
              <th>Ongkir</th>
              <th>Total</th>
            </tr>
          </thead>
          <tbody id="previewTable"></tbody>
        </table>
      </div>

      <!-- Total + LUNAS -->
      <div class="flex flex-col items-end relative z-10">
        <div class="text-right mb-4">
          <p class="font-semibold mt-2">
            Subtotal: <span id="subtotal">0</span>
          </p>
          <p class="font-bold text-xl total-black mt-4">
            Total: <span id="total">0</span>
          </p>
        </div>
        <div id="stampLunas" class="text-right mb-4 hidden">
          <span class="stamp-lunas">LUNAS</span>
        </div>
      </div>

      <!-- Footer -->
      <p class="mt-6 text-gray-700 relative z-10 text-sm sm:text-base">
        Thank you for your order.<br />
        Pembayaran dapat dilakukan ke:<br />
        Bank BCA 1661739679 | Bank Jakarta 50020082764: a/n Pancaningsih<br />
        Instagram: @Dlingoscarves | telfon: 0857-1825-1218
      </p>
    </div>

    <script>
      const addItemBtn = document.getElementById("addItem");
      const itemsContainer = document.getElementById("itemsContainer");

      // Nomor invoice otomatis
      let lastInvoiceNumber = localStorage.getItem("lastInvoiceNumber") || "0";
      function getNextInvoiceNumber() {
        let nextNumber = parseInt(lastInvoiceNumber) + 1;
        lastInvoiceNumber = nextNumber;
        localStorage.setItem("lastInvoiceNumber", lastInvoiceNumber);
        return "INC-" + String(nextNumber).padStart(3, "0");
      }

      addItemBtn.addEventListener("click", () => {
        const div = document.createElement("div");
        div.className = "flex flex-wrap gap-2 mb-2";
        div.innerHTML = `
          <input type="text" placeholder="Jenis Hijab" class="border px-3 py-2 rounded w-full sm:w-1/4 item-name">
          <input type="text" placeholder="Warna / Motif" class="border px-3 py-2 rounded w-full sm:w-1/4 item-color">
          <input type="number" placeholder="Jumlah" class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-qty">
          <input type="number" placeholder="Harga (Rp)" class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-price">
          <input type="number" placeholder="Ongkir (Rp)" class="border px-3 py-2 rounded w-1/2 sm:w-1/8 item-ongkir">
        `;
        itemsContainer.appendChild(div);
      });

      function generatePDF(filename, showLunas) {
        document.getElementById("invoiceNumber").textContent =
          getNextInvoiceNumber();
        document.getElementById("previewName").textContent =
          document.getElementById("billName").value || "Nama Penerima";
        document.getElementById("previewAddress").textContent =
          document.getElementById("billAddress").value || "Alamat Penerima";
        document.getElementById("previewDate").textContent =
          document.getElementById("invoiceDate").value || "-";
        document.getElementById("previewDue").textContent =
          document.getElementById("dueDate").value || "-";

        const tbody = document.getElementById("previewTable");
        tbody.innerHTML = "";
        let subtotal = 0;
        const names = document.querySelectorAll(".item-name");
        const colors = document.querySelectorAll(".item-color");
        const qtys = document.querySelectorAll(".item-qty");
        const prices = document.querySelectorAll(".item-price");
        const ongkirs = document.querySelectorAll(".item-ongkir");

        for (let i = 0; i < names.length; i++) {
          const name = names[i].value || "-";
          const color = colors[i].value || "-";
          const qty = parseFloat(qtys[i].value) || 0;
          const price = parseFloat(prices[i].value) || 0;
          const ongkir = parseFloat(ongkirs[i].value) || 0;
          const total = qty * price + ongkir;
          subtotal += total;

          const tr = document.createElement("tr");
          tr.className = i % 2 === 0 ? "bg-light-navy-bg" : "";
          tr.innerHTML = `
            <td>${name}</td>
            <td>${color}</td>
            <td class="text-right">${qty}</td>
            <td class="text-right">Rp${price.toLocaleString()}</td>
            <td class="text-right">Rp${ongkir.toLocaleString()}</td>
            <td class="text-right">Rp${total.toLocaleString()}</td>
          `;
          tbody.appendChild(tr);
        }

        document.getElementById("subtotal").textContent =
          "Rp" + subtotal.toLocaleString();
        document.getElementById("total").textContent =
          "Rp" + subtotal.toLocaleString();
        showLunas
          ? document.getElementById("stampLunas").classList.remove("hidden")
          : document.getElementById("stampLunas").classList.add("hidden");

        const invoice = document.getElementById("invoicePreview");
        const opt = {
          margin: 5,
          filename: filename,
          image: { type: "jpeg", quality: 1 },
          html2canvas: { scale: 3, width: invoice.scrollWidth },
          jsPDF: { unit: "mm", format: "a4", orientation: "portrait" },
        };
        html2pdf().set(opt).from(invoice).save();
      }

      document
        .getElementById("generateInvoiceTagihan")
        .addEventListener("click", () => generatePDF("Tagihan.pdf", false));
      document
        .getElementById("generateInvoicePelunasan")
        .addEventListener("click", () => generatePDF("Pelunasan.pdf", true));
    </script>
  </body>
</html>
